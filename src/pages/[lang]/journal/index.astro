---
import MainLayout from "~/layouts/main.astro"
import { getLanguagePaths } from "~/utils/langs"

export function getStaticPaths() {
  return getLanguagePaths()
}

const lang = Astro.params.lang as string
---

<MainLayout title={lang === "zh" ? "æ¯æ—¥æ—¥è®°" : "Daily Journal"} description={lang === "zh" ? "è®°å½•æ‚¨çš„æ€è€ƒã€åæ€å’Œæˆé•¿å†ç¨‹" : "Document your thoughts, reflections, and personal growth"}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8 text-center">
      {lang === "zh" ? "ğŸ“” æ¯æ—¥æ—¥è®°" : "ğŸ“” Daily Journal"}
    </h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Main Journal Entry Area -->
      <div class="lg:col-span-2">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold">
              {lang === "zh" ? "ä»Šæ—¥æ„Ÿæƒ³" : "Today's Entry"}
            </h2>
            <div class="text-sm text-gray-500" id="current-date"></div>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">
              {lang === "zh" ? "å¿ƒæƒ…æŒ‡æ•°" : "Mood Rating"}
            </label>
            <div class="flex space-x-2" id="mood-selector">
              <button onclick="selectMood(1)" class="mood-btn text-2xl p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-mood="1">ğŸ˜¢</button>
              <button onclick="selectMood(2)" class="mood-btn text-2xl p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-mood="2">ğŸ˜Ÿ</button>
              <button onclick="selectMood(3)" class="mood-btn text-2xl p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-mood="3">ğŸ˜</button>
              <button onclick="selectMood(4)" class="mood-btn text-2xl p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-mood="4">ğŸ˜Š</button>
              <button onclick="selectMood(5)" class="mood-btn text-2xl p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-mood="5">ğŸ˜„</button>
            </div>
          </div>
          
          <div class="mb-4">
            <label for="journal-entry" class="block text-sm font-medium mb-2">
              {lang === "zh" ? "ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ‚¨æœ‰ä»€ä¹ˆæ„Ÿæ‚Ÿï¼Ÿ" : "What happened today? What are your thoughts?"}
            </label>
            <textarea 
              id="journal-entry"
              rows="10"
              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder={lang === "zh" ? "åˆ†äº«æ‚¨ä»Šå¤©çš„ç»å†ã€å­¦ä¹ ã€æ„Ÿæ‚Ÿæˆ–ä»»ä½•æƒ³è¦è®°å½•çš„å†…å®¹..." : "Share your experiences, learnings, insights, or anything you'd like to document today..."}
            ></textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">
              {lang === "zh" ? "ä»Šæ—¥æ ‡ç­¾" : "Today's Tags"}
            </label>
            <div class="flex flex-wrap gap-2 mb-2" id="selected-tags">
              <!-- Selected tags will appear here -->
            </div>
            <div class="flex flex-wrap gap-2">
              <button onclick="toggleTag('learning')" class="tag-btn px-3 py-1 text-sm border rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                {lang === "zh" ? "å­¦ä¹ " : "Learning"}
              </button>
              <button onclick="toggleTag('work')" class="tag-btn px-3 py-1 text-sm border rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                {lang === "zh" ? "å·¥ä½œ" : "Work"}
              </button>
              <button onclick="toggleTag('family')" class="tag-btn px-3 py-1 text-sm border rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                {lang === "zh" ? "å®¶åº­" : "Family"}
              </button>
              <button onclick="toggleTag('creativity')" class="tag-btn px-3 py-1 text-sm border rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                {lang === "zh" ? "åˆ›é€ åŠ›" : "Creativity"}
              </button>
              <button onclick="toggleTag('science')" class="tag-btn px-3 py-1 text-sm border rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                {lang === "zh" ? "ç§‘å­¦" : "Science"}
              </button>
              <button onclick="toggleTag('music')" class="tag-btn px-3 py-1 text-sm border rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                {lang === "zh" ? "éŸ³ä¹" : "Music"}
              </button>
            </div>
          </div>
          
          <div class="flex space-x-3">
            <button 
              onclick="saveEntry()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors"
            >
              {lang === "zh" ? "ä¿å­˜æ¡ç›®" : "Save Entry"}
            </button>
            <button 
              onclick="clearForm()"
              class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors"
            >
              {lang === "zh" ? "æ¸…ç©º" : "Clear"}
            </button>
          </div>
        </div>
      </div>
      
      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Recent Entries -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-4">
            {lang === "zh" ? "æœ€è¿‘æ¡ç›®" : "Recent Entries"}
          </h3>
          <div id="recent-entries" class="space-y-3">
            <p class="text-gray-500 text-sm">
              {lang === "zh" ? "æš‚æ— æ¡ç›®ã€‚å¼€å§‹å†™ä¸‹æ‚¨çš„ç¬¬ä¸€ä¸ªæƒ³æ³•å§ï¼" : "No entries yet. Start by writing your first thoughts!"}
            </p>
          </div>
        </div>
        
        <!-- Inspirational Quote -->
        <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-4">
            {lang === "zh" ? "æ¯æ—¥å¯å‘" : "Daily Inspiration"}
          </h3>
          <blockquote class="text-sm italic text-gray-700 dark:text-gray-300" id="daily-quote">
            {lang === "zh" 
              ? "\"æ¢ç´¢äººæ€§çš„æ·±åº¦ï¼Œç†è§£å®‡å®™çš„å¥¥ç§˜ï¼Œåœ¨ç§‘å­¦ä¸è‰ºæœ¯çš„äº¤èä¸­å¯»æ‰¾çœŸç†ã€‚\" - Bernard Denzil Wilkes" 
              : "\"In exploring the depths of humanity and understanding the mysteries of the universe, we find truth in the convergence of science and art.\" - Bernard Denzil Wilkes"
            }
          </blockquote>
        </div>
        
        <!-- Reflection Prompts -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-4">
            {lang === "zh" ? "åæ€æç¤º" : "Reflection Prompts"}
          </h3>
          <div class="space-y-2 text-sm" id="reflection-prompts">
            <!-- Prompts will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>
</MainLayout>

<script>
  let selectedMood = null;
  let selectedTags = new Set();
  
  document.addEventListener('DOMContentLoaded', function() {
    // Set current date
    const today = new Date();
    document.getElementById('current-date').textContent = today.toLocaleDateString();
    
    // Load reflection prompts
    loadReflectionPrompts();
    
    // Load recent entries
    loadRecentEntries();
  });
  
  function selectMood(mood) {
    // Remove previous selection
    document.querySelectorAll('.mood-btn').forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
    });
    
    // Add selection to clicked button
    const selectedBtn = document.querySelector(`[data-mood="${mood}"]`);
    selectedBtn.classList.add('bg-blue-500', 'text-white');
    selectedMood = mood;
  }
  
  function toggleTag(tag) {
    const tagBtn = event.target;
    const selectedTagsContainer = document.getElementById('selected-tags');
    
    if (selectedTags.has(tag)) {
      // Remove tag
      selectedTags.delete(tag);
      tagBtn.classList.remove('bg-blue-500', 'text-white');
      // Remove from selected tags display
      const tagElement = document.querySelector(`#selected-tags [data-tag="${tag}"]`);
      if (tagElement) tagElement.remove();
    } else {
      // Add tag
      selectedTags.add(tag);
      tagBtn.classList.add('bg-blue-500', 'text-white');
      // Add to selected tags display
      const tagElement = document.createElement('span');
      tagElement.className = 'px-3 py-1 text-sm bg-blue-500 text-white rounded-full';
      tagElement.setAttribute('data-tag', tag);
      tagElement.textContent = tagBtn.textContent;
      selectedTagsContainer.appendChild(tagElement);
    }
  }
  
  function saveEntry() {
    const entry = document.getElementById('journal-entry').value.trim();
    if (!entry) {
      alert(document.documentElement.lang === 'zh' ? 'è¯·å†™ä¸‹ä¸€äº›å†…å®¹' : 'Please write something');
      return;
    }
    
    const journalEntry = {
      date: new Date().toISOString(),
      mood: selectedMood,
      content: entry,
      tags: Array.from(selectedTags)
    };
    
    // Save to localStorage (in a real app, this would save to a server)
    const existingEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
    existingEntries.unshift(journalEntry);
    localStorage.setItem('journalEntries', JSON.stringify(existingEntries));
    
    // Show success message
    alert(document.documentElement.lang === 'zh' ? 'æ¡ç›®å·²ä¿å­˜ï¼' : 'Entry saved!');
    
    // Clear form
    clearForm();
    
    // Reload recent entries
    loadRecentEntries();
  }
  
  function clearForm() {
    document.getElementById('journal-entry').value = '';
    selectedMood = null;
    selectedTags.clear();
    
    // Clear UI selections
    document.querySelectorAll('.mood-btn').forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
    });
    
    document.querySelectorAll('.tag-btn').forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
    });
    
    document.getElementById('selected-tags').innerHTML = '';
  }
  
  function loadRecentEntries() {
    const entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
    const container = document.getElementById('recent-entries');
    
    if (entries.length === 0) {
      container.innerHTML = `<p class="text-gray-500 text-sm">${
        document.documentElement.lang === 'zh' 
          ? 'æš‚æ— æ¡ç›®ã€‚å¼€å§‹å†™ä¸‹æ‚¨çš„ç¬¬ä¸€ä¸ªæƒ³æ³•å§ï¼' 
          : 'No entries yet. Start by writing your first thoughts!'
      }</p>`;
      return;
    }
    
    container.innerHTML = entries.slice(0, 5).map(entry => {
      const date = new Date(entry.date).toLocaleDateString();
      const preview = entry.content.substring(0, 60) + (entry.content.length > 60 ? '...' : '');
      const moodEmoji = ['', 'ğŸ˜¢', 'ğŸ˜Ÿ', 'ğŸ˜', 'ğŸ˜Š', 'ğŸ˜„'][entry.mood] || '';
      
      return `
        <div class="border-l-4 border-blue-500 pl-3 py-2">
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs text-gray-500">${date}</span>
            <span class="text-sm">${moodEmoji}</span>
          </div>
          <p class="text-sm text-gray-700 dark:text-gray-300">${preview}</p>
        </div>
      `;
    }).join('');
  }
  
  function loadReflectionPrompts() {
    const prompts = {
      en: [
        "What did I learn about myself today?",
        "How did I grow or challenge myself?",
        "What am I most grateful for right now?",
        "What patterns am I noticing in my thoughts?",
        "How did I contribute to others' wellbeing today?"
      ],
      zh: [
        "ä»Šå¤©æˆ‘å¯¹è‡ªå·±æœ‰ä»€ä¹ˆæ–°çš„è®¤è¯†ï¼Ÿ",
        "æˆ‘æ˜¯å¦‚ä½•æˆé•¿æˆ–æŒ‘æˆ˜è‡ªå·±çš„ï¼Ÿ",
        "ç°åœ¨æˆ‘æœ€æ„Ÿæ¿€ä»€ä¹ˆï¼Ÿ",
        "æˆ‘åœ¨è‡ªå·±çš„æ€ç»´ä¸­æ³¨æ„åˆ°äº†ä»€ä¹ˆæ¨¡å¼ï¼Ÿ",
        "ä»Šå¤©æˆ‘æ˜¯å¦‚ä½•ä¸ºä»–äººçš„ç¦ç¥‰åšå‡ºè´¡çŒ®çš„ï¼Ÿ"
      ]
    };
    
    const lang = document.documentElement.lang || 'en';
    const container = document.getElementById('reflection-prompts');
    const langPrompts = prompts[lang] || prompts.en;
    
    container.innerHTML = langPrompts.map(prompt => 
      `<div class="cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors" onclick="usePrompt('${prompt}')">${prompt}</div>`
    ).join('');
  }
  
  function usePrompt(prompt) {
    const textarea = document.getElementById('journal-entry');
    if (textarea.value.trim() === '') {
      textarea.value = prompt + '\n\n';
      textarea.focus();
    }
  }
</script>